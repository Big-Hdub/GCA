import{b as c,r,e as z,u as P,c as B,j as e,F as G,h as K,k as R,o as U,p as q}from"./index-b5fc81fe.js";import{R as M}from"./RenderMarkdown-185bed96.js";import{S as E}from"./Sidebar-ae7ae17a.js";function A({edit:k}){var N,S,$,L;const C=(N=c(s=>s.session.user))==null?void 0:N.settings.font_size,a=(S=c(s=>s.session.user))==null?void 0:S.settings.theme,w=($=c(s=>s.session.user))==null?void 0:$.settings.role,p=c(s=>s.session.user),u=c(s=>s.lessons.lessons),o=c(s=>s.courses.courses),[f,F]=r.useState(),{courseId:j,lessonId:n}=z(),[i,y]=r.useState({}),[d,v]=r.useState(""),[l,g]=r.useState(""),[x,b]=r.useState(""),m=P(),h=B();r.useEffect(()=>{(!p||w!=="teacher")&&h("/")},[h,p,w]),r.useEffect(()=>{(async()=>{n&&d===""&&l===""&&x===""?u?(v(u.title),g(u.text),b(u.type)):await m(K(n)):f||await m(R(+j)).then(F(!0))})()},[m,j,n,d,l,x,f,u]);const T=async s=>{s.preventDefault(),y({});let t=!1;n?t=await m(U(+n,{title:d,text:l,type:x})):t=await m(q(+j,{title:d,text:l,type:x})),t!=null&&t.id?(h(`/lessons/${t.id}`),window.scroll(0,0)):t?y(t):n&&(h(`/lessons/${n}`),window.scroll(0,0))},I=s=>{if(s.key==="Tab"){s.preventDefault();const t=s.target.selectionStart,D=s.target.selectionEnd;g(l.substring(0,t)+"    "+l.substring(D)),setTimeout(()=>{s.target.selectionStart=s.target.selectionEnd=t+4},0)}};return e.jsx(e.Fragment,{children:p&&o&&e.jsxs("div",{children:[e.jsx("div",{className:`flex column between ${a}1`,children:e.jsxs("main",{id:"main-container",className:"flex minh100 gap-60 mtop-229",children:[k?e.jsx(E,{selection:"lesson",lesson:+n,course:o.course,lessons:o.lessons,teacher:!0}):e.jsx(E,{selection:"newLesson",course:o.course,lessons:o.lessons}),f&&((L=o==null?void 0:o.course)==null?void 0:L.title)&&e.jsx(e.Fragment,{children:e.jsx("div",{id:"lesson-container",className:`flex column wp100 gap-40 ${a} font-${C} ${a}2`,children:e.jsxs("form",{id:"create-lesson-form",className:"flex column gap-15",onSubmit:T,children:[e.jsx("label",{children:"Title:"}),e.jsx("input",{type:"text",value:d,className:`w575 ${a}1 ${a}`,onChange:s=>v(s.target.value)}),i.title&&e.jsx("p",{className:"error",children:i.title}),e.jsx("label",{children:"Preview:"}),e.jsx("div",{className:`minh100px flex column gap-25 padding-40 ${a}1`,children:e.jsx(M,{text:l})}),e.jsx("label",{children:"Enter your markdown here:"}),e.jsx("textarea",{type:"text",value:l,onKeyDown:I,className:`minh100px padding-15 ${a}1 ${a}`,onChange:s=>g(s.target.value)}),i.text&&e.jsx("p",{className:"error",children:i.text}),e.jsx("label",{children:"Lesson type:"}),e.jsx("div",{className:"w575",children:e.jsxs("select",{type:"text",defaultValue:x,onChange:s=>b(s.target.value),children:[e.jsx("option",{value:"",className:"w575",disabled:!0,children:"Select one..."}),e.jsx("option",{value:"lesson",className:"w575",children:"Lesson"}),e.jsx("option",{value:"quiz",className:"w575",children:"Quiz"})]})}),i.type&&e.jsx("p",{className:"error",children:i.type}),e.jsx("button",{className:"button aselfend",type:"submit",children:n?"Update lesson":"Create lesson"})]})})})]})}),e.jsx(G,{})]})})}export{A as default};
